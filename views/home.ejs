<section id="post-section">
    <h2>Posts</h2>
    <% if(locals.user) { %>
    <form action="/posts/create" id="post-form" method="POST">
        <h4>Add a post</h4>
        <textarea name="content" cols="30" rows="3" placeholder="Write a post..." required></textarea>
        <input type="submit" value="Post">
    </form>
    <% } %>

    <ul>
        <% for(let post of posts) { %>
        <li>
            <p>
                <% if(locals.user && locals.user.id == post.user.id) { %>
                <small>
                    <a href="/posts/destroy/<%= post.id %>">x</a>
                </small>
                <% } %>
                <%= post.content %>
                <br>
                <small>
                    <%= post.user.name %>
                </small>
            </p>
            <div class="post-comments">
                <% if (locals.user) { %>
                <form action="/comments/create" method="POST">
                    <input type="text" name="content" placeholder="Comment goes here..." required>
                    <input type="hidden" name="post_id" value="<%= post._id %>">
                    <input type="submit" value="Add Comment">
                </form>
                <% } %>
                <div class="post-comments-list">
                    <ul id="post-comments-<%= post._id %>">
                        <% for (let comment of post.comments) { %>
                        <li>
                            <p>
                                <% if(locals.user && locals.user.id == comment.user.id) { %>
                                <small>
                                    <a href="/comments/destroy/<%= comment.id %>">x</a>
                                </small>
                                <% } %>
                                <%= comment.content %>
                                <br>
                                <small>
                                    <%= comment.user.name %>
                                </small>
                            </p>
                        </li>
                        <% } %>
                    </ul>
                </div>
            </div>
        </li>
        <% } %>
    </ul>

</section>